<UserControl x:Class="ExcellCore.Module.Core.Inventory.Views.InventoryWorkspaceView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             Loaded="OnLoaded">
  <Grid Margin="16">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
    </Grid.RowDefinitions>

    <StackPanel>
      <StackPanel Orientation="Horizontal">
        <TextBlock Text="Inventory Operations"
                   FontSize="20"
                   FontWeight="SemiBold"/>
        <TextBlock Text="Stock ledger and replenishment insights"
                   Margin="12,0,0,0"
                   Foreground="Gray"
                   VerticalAlignment="Bottom"/>
      </StackPanel>
      <Expander Header="Getting Started (Clinic)"
                IsExpanded="False"
                Margin="0,8,0,0">
        <StackPanel>
          <TextBlock Text="Pick Location (All or specific) and use Search to narrow by SKU/description."
              TextWrapping="Wrap"/>
          <TextBlock Text="Alerts show shrinkage or stock-out risk; follow the 'Next step' hint to reorder or audit."
              TextWrapping="Wrap"
              Margin="0,4,0,0"/>
          <TextBlock Text="Refresh updates analytics and ledger view; 'Last analyzed' shows freshness."
              TextWrapping="Wrap"
              Margin="0,4,0,0"/>
        </StackPanel>
      </Expander>
    </StackPanel>

    <Grid Grid.Row="1"
          Margin="0,16,0,16">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="200"/>
        <ColumnDefinition Width="200"/>
        <ColumnDefinition Width="*"/>
        <ColumnDefinition Width="Auto"/>
      </Grid.ColumnDefinitions>

      <StackPanel>
        <TextBlock Text="Location"
                   FontWeight="SemiBold"/>
        <ComboBox ItemsSource="{Binding Locations}"
                  SelectedItem="{Binding SelectedLocation, Mode=TwoWay}"
                  Margin="0,6,12,0"/>
      </StackPanel>

      <StackPanel Grid.Column="1">
        <TextBlock Text="Search"
                   FontWeight="SemiBold"/>
        <TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                 Margin="0,6,12,0"/>
      </StackPanel>

      <StackPanel Grid.Column="2"
                  Orientation="Horizontal"
                  HorizontalAlignment="Left"
                  VerticalAlignment="Bottom">
        <Border Style="{StaticResource ModuleSummaryCardNeutralStyle}">
          <StackPanel>
            <TextBlock Text="SKUs"
                       Style="{StaticResource ModuleSummaryLabelStyle}"/>
            <TextBlock Text="{Binding Summary.TotalSkus}"
                       Style="{StaticResource ModuleSummaryValueStyle}"/>
          </StackPanel>
        </Border>
        <Border Style="{StaticResource ModuleSummaryCardNeutralStyle}">
          <StackPanel>
            <TextBlock Text="On Hand"
                       Style="{StaticResource ModuleSummaryLabelStyle}"/>
            <TextBlock Text="{Binding Summary.TotalQuantity}"
                       Style="{StaticResource ModuleSummaryValueStyle}"/>
          </StackPanel>
        </Border>
        <Border Style="{StaticResource ModuleSummaryCardWarningStyle}"
                Margin="0">
          <StackPanel>
            <TextBlock Text="Reorder Alerts"
                       Style="{StaticResource ModuleSummaryLabelWarningStyle}"/>
            <TextBlock Text="{Binding Summary.LowStockCount}"
                       Style="{StaticResource ModuleSummaryValueStyle}"/>
          </StackPanel>
        </Border>
      </StackPanel>

      <Button Grid.Column="3"
              Content="Refresh"
              Width="96"
              Height="32"
              HorizontalAlignment="Right"
              VerticalAlignment="Bottom"
              Command="{Binding RefreshCommand}"/>
    </Grid>

    <Grid Grid.Row="2">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="*"/>
      </Grid.RowDefinitions>

      <StackPanel Orientation="Horizontal">
        <TextBlock Text="{Binding StatusMessage}"
                   Foreground="Gray"/>
        <TextBlock Text="{Binding LastAnalyzed}"
                   Margin="12,0,0,0"
                   Foreground="#FF5B7085"/>
      </StackPanel>

      <ItemsControl Grid.Row="1"
                    ItemsSource="{Binding AnomalyAlerts}"
                    Margin="0,8,0,0">
        <ItemsControl.ItemsPanel>
          <ItemsPanelTemplate>
            <WrapPanel Orientation="Horizontal"/>
          </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>
        <ItemsControl.ItemTemplate>
          <DataTemplate>
            <Border Padding="10"
                    Margin="0,0,12,12"
                    CornerRadius="6">
              <StackPanel ToolTip="Alerts generated from velocity/shrinkage analysis">
                <StackPanel Orientation="Horizontal">
                  <TextBlock Text="{Binding ItemName}"
                             FontWeight="SemiBold"/>
                  <TextBlock Text="{Binding Location}"
                             Margin="8,0,0,0"
                             Foreground="#FF5B7085"/>
                </StackPanel>
                <TextBlock Text="{Binding Detail}"
                           Margin="0,2,0,0"
                           TextWrapping="Wrap"/>
                <TextBlock Text="{Binding QuantityDisplay}"
                           Margin="0,2,0,0"/>
                <TextBlock Text="{Binding VelocityDisplay}"
                           Margin="0,2,0,0"/>
                <TextBlock Text="{Binding DetectedDisplay}"
                           Margin="0,2,0,0"
                           Foreground="#FF5B7085"
                           FontSize="12"/>
                <StackPanel Orientation="Horizontal"
                            Margin="0,6,0,0">
                  <TextBlock Text="Next step"
                             FontWeight="SemiBold"/>
                  <TextBlock Text=":"
                             Margin="4,0,0,0"/>
                  <TextBlock Text="{Binding ActionHint}"
                             Margin="4,0,0,0"
                             Foreground="#FF5B7085"/>
                </StackPanel>
              </StackPanel>
              <Border.Style>
                <Style TargetType="Border"
                       BasedOn="{StaticResource ModuleSummaryCardNeutralStyle}">
                  <Style.Triggers>
                    <DataTrigger Binding="{Binding SeverityTag}"
                                 Value="Warning">
                      <Setter Property="Background"
                              Value="#FFF8F0E3"/>
                      <Setter Property="BorderBrush"
                              Value="#FFEEDFCC"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding SeverityTag}"
                                 Value="Critical">
                      <Setter Property="Background"
                              Value="{StaticResource SummaryCardWarningBackgroundBrush}"/>
                      <Setter Property="BorderBrush"
                              Value="{StaticResource SummaryCardWarningBorderBrush}"/>
                    </DataTrigger>
                  </Style.Triggers>
                </Style>
              </Border.Style>
            </Border>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>

      <TextBlock Grid.Row="1"
                 Text="No anomaly alerts detected."
                 HorizontalAlignment="Center"
                 VerticalAlignment="Center"
                 Foreground="Gray">
        <TextBlock.Style>
          <Style TargetType="TextBlock">
            <Setter Property="Visibility"
                    Value="Collapsed"/>
            <Style.Triggers>
              <DataTrigger Binding="{Binding AnomalyAlerts.Count}"
                           Value="0">
                <Setter Property="Visibility"
                        Value="Visible"/>
              </DataTrigger>
            </Style.Triggers>
          </Style>
        </TextBlock.Style>
      </TextBlock>

      <DataGrid Grid.Row="2"
                ItemsSource="{Binding StockLedger}"
                SelectedItem="{Binding SelectedItem, Mode=TwoWay}"
                AutoGenerateColumns="False"
                CanUserAddRows="False"
                CanUserDeleteRows="False"
                IsReadOnly="True"
                HeadersVisibility="Column"
                BorderBrush="#FFDDDDDD"
                BorderThickness="1"
                Margin="0,8,0,0">
        <DataGrid.Columns>
          <DataGridTextColumn Header="SKU"
                              Binding="{Binding Sku}"
                              Width="150"/>
          <DataGridTextColumn Header="Description"
                              Binding="{Binding Description}"
                              Width="2*"/>
          <DataGridTextColumn Header="Location"
                              Binding="{Binding Location}"
                              Width="150"/>
          <DataGridTextColumn Header="On Hand"
                              Binding="{Binding QuantityOnHand}"
                              Width="100"/>
          <DataGridTextColumn Header="Reorder Point"
                              Binding="{Binding ReorderPoint}"
                              Width="120"/>
          <DataGridTextColumn Header="On Order"
                              Binding="{Binding OnOrder}"
                              Width="100"/>
          <DataGridTextColumn Header="Last Movement"
                              Binding="{Binding LastMovement, StringFormat=d}"
                              Width="130"/>
          <DataGridTextColumn Header="Status"
                              Binding="{Binding ReorderStatus}"
                              Width="110"/>
        </DataGrid.Columns>
      </DataGrid>
    </Grid>
  </Grid>
</UserControl>
