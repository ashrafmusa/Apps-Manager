<UserControl x:Class="ExcellCore.Module.Core.Financials.Views.FinancialsWorkspaceView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             Loaded="OnLoaded">
  <UserControl.Resources>
    <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
  </UserControl.Resources>
  <Grid Margin="16">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
    </Grid.RowDefinitions>

    <StackPanel Orientation="Horizontal">
      <TextBlock Text="Financial Console" FontSize="20" FontWeight="SemiBold" />
      <TextBlock Text="Ledger, invoicing, and payment flows" Margin="12,0,0,0" Foreground="Gray" VerticalAlignment="Bottom" />
    </StackPanel>

    <Grid Grid.Row="1" Margin="0,16,0,16">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="160" />
        <ColumnDefinition Width="200" />
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="Auto" />
      </Grid.ColumnDefinitions>

      <StackPanel>
        <TextBlock Text="Status" FontWeight="SemiBold" />
        <ComboBox ItemsSource="{Binding StatusFilters}"
                  SelectedItem="{Binding SelectedStatus, Mode=TwoWay}"
                  Margin="0,6,12,0" />
      </StackPanel>

      <StackPanel Grid.Column="1">
        <TextBlock Text="Search" FontWeight="SemiBold" />
        <TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" Margin="0,6,12,0" />
      </StackPanel>

      <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Bottom">
        <Border Style="{StaticResource ModuleSummaryCardNeutralStyle}">
          <StackPanel>
            <TextBlock Text="Outstanding" Style="{StaticResource ModuleSummaryLabelStyle}" />
            <TextBlock Text="{Binding Summary.OutstandingBalance, StringFormat={}{0:C0}}" Style="{StaticResource ModuleSummaryValueStyle}" />
          </StackPanel>
        </Border>
        <Border Style="{StaticResource ModuleSummaryCardWarningStyle}">
          <StackPanel>
            <TextBlock Text="Overdue" Style="{StaticResource ModuleSummaryLabelWarningStyle}" />
            <TextBlock Text="{Binding Summary.OverdueInvoices}" Style="{StaticResource ModuleSummaryValueStyle}" />
          </StackPanel>
        </Border>
        <Border Style="{StaticResource ModuleSummaryCardSuccessStyle}" Margin="0">
          <StackPanel>
            <TextBlock Text="Collections (7d)" Style="{StaticResource ModuleSummaryLabelSuccessStyle}" />
            <TextBlock Text="{Binding Summary.Collections7Day, StringFormat={}{0:C0}}" Style="{StaticResource ModuleSummaryValueStyle}" />
          </StackPanel>
        </Border>
      </StackPanel>

      <StackPanel Grid.Column="3" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Bottom">
        <Button Content="Toggle Cashflow"
                Command="{Binding ToggleCashflowCommand}"
                Width="130"
                Height="32"
                Margin="0,0,8,0" />
        <Button Content="Refresh"
                Command="{Binding RefreshCommand}"
                Width="96"
                Height="32" />
      </StackPanel>
    </Grid>

    <Grid Grid.Row="2">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto" />
        <RowDefinition Height="*" />
        <RowDefinition Height="Auto" />
      </Grid.RowDefinitions>

      <TextBlock Text="{Binding StatusMessage}" Foreground="Gray" />

      <DataGrid Grid.Row="1"
                ItemsSource="{Binding Invoices}"
                SelectedItem="{Binding SelectedInvoice, Mode=TwoWay}"
                AutoGenerateColumns="False"
                CanUserAddRows="False"
                CanUserDeleteRows="False"
                IsReadOnly="True"
                HeadersVisibility="Column"
                BorderBrush="#FFDDDDDD"
                BorderThickness="1"
                Margin="0,8,0,12">
        <DataGrid.Columns>
          <DataGridTextColumn Header="Invoice" Binding="{Binding InvoiceNumber}" Width="120" />
          <DataGridTextColumn Header="Customer" Binding="{Binding Customer}" Width="*" />
          <DataGridTextColumn Header="Amount" Binding="{Binding Amount, StringFormat={}{0:C}}" Width="120" />
          <DataGridTextColumn Header="Invoice Date" Binding="{Binding InvoiceDate, StringFormat=d}" Width="120" />
          <DataGridTextColumn Header="Due Date" Binding="{Binding DueDate, StringFormat=d}" Width="120" />
          <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100" />
          <DataGridTextColumn Header="Paid" Binding="{Binding AmountPaid, StringFormat={}{0:C}}" Width="100" />
          <DataGridTextColumn Header="Balance" Binding="{Binding BalanceDue, StringFormat={}{0:C}}" Width="100" />
        </DataGrid.Columns>
      </DataGrid>

      <Border Grid.Row="2"
              Visibility="{Binding ShowCashflow, Converter={StaticResource BooleanToVisibilityConverter}}"
              BorderBrush="#FFDDDDDD"
              BorderThickness="1"
              Padding="12">
        <StackPanel>
          <TextBlock Text="Weekly Cashflow" FontWeight="SemiBold" Margin="0,0,0,8" />
          <ItemsControl ItemsSource="{Binding Cashflow}">
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <Grid Margin="0,4,0,4">
                  <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="100" />
                    <ColumnDefinition Width="120" />
                    <ColumnDefinition Width="120" />
                    <ColumnDefinition Width="*" />
                  </Grid.ColumnDefinitions>
                  <TextBlock Text="{Binding Date, StringFormat=d}" />
                  <TextBlock Grid.Column="1" Text="{Binding Receipts, StringFormat={}{0:C0}}" />
                  <TextBlock Grid.Column="2" Text="{Binding Disbursements, StringFormat={}{0:C0}}" />
                  <ProgressBar Grid.Column="3"
                               Height="12"
                               Minimum="-5000"
                               Maximum="25000"
                               Value="{Binding Net, Mode=OneWay}" />
                </Grid>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
        </StackPanel>
      </Border>
    </Grid>
  </Grid>
</UserControl>
