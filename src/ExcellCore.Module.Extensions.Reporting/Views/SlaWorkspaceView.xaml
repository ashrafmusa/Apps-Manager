<UserControl x:Class="ExcellCore.Module.Extensions.Reporting.Views.SlaWorkspaceView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             Loaded="OnLoaded">
  <Grid Margin="16">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <StackPanel>
      <StackPanel Orientation="Horizontal">
        <TextBlock Text="{Binding Title}"
                   FontSize="20"
                   FontWeight="SemiBold"/>
        <TextBlock Text="{Binding Subtitle}"
                   Margin="12,0,0,0"
                   Foreground="Gray"
                   VerticalAlignment="Bottom"/>
        <TextBlock Text="{Binding LastUpdated}"
                   Margin="12,0,0,0"
                   Foreground="#FF5B7085"
                   VerticalAlignment="Bottom"/>
      </StackPanel>
      <Expander Header="Getting Started (Clinic)"
                IsExpanded="False"
                Margin="0,8,0,0">
        <StackPanel>
          <TextBlock Text="Predictive cards show at-risk approvals with ETA and driver; follow the 'Next step' hint."
              TextWrapping="Wrap"/>
          <TextBlock Text="Use Refresh after long idle sessions; SLA heat map and escalation queue update together."
              TextWrapping="Wrap"
              Margin="0,4,0,0"/>
          <TextBlock Text="Escalate high-risk (High + short ETA), send reminders for Medium, and monitor Low."
              TextWrapping="Wrap"
              Margin="0,4,0,0"/>
        </StackPanel>
      </Expander>
    </StackPanel>

    <ItemsControl Grid.Row="1"
                  ItemsSource="{Binding SummaryCards}"
                  Margin="0,16,0,16">
      <ItemsControl.ItemsPanel>
        <ItemsPanelTemplate>
          <WrapPanel Orientation="Horizontal"/>
        </ItemsPanelTemplate>
      </ItemsControl.ItemsPanel>
      <ItemsControl.ItemTemplate>
        <DataTemplate>
          <Border>
            <Border.Style>
              <Style TargetType="Border"
                     BasedOn="{StaticResource ModuleSummaryCardNeutralStyle}">
                <Style.Triggers>
                  <DataTrigger Binding="{Binding Severity}"
                               Value="Warning">
                    <Setter Property="Background"
                            Value="{StaticResource SummaryCardWarningBackgroundBrush}"/>
                    <Setter Property="BorderBrush"
                            Value="{StaticResource SummaryCardWarningBorderBrush}"/>
                  </DataTrigger>
                  <DataTrigger Binding="{Binding Severity}"
                               Value="Success">
                    <Setter Property="Background"
                            Value="{StaticResource SummaryCardSuccessBackgroundBrush}"/>
                    <Setter Property="BorderBrush"
                            Value="{StaticResource SummaryCardSuccessBorderBrush}"/>
                  </DataTrigger>
                </Style.Triggers>
              </Style>
            </Border.Style>
            <StackPanel>
              <TextBlock Text="{Binding Title}">
                <TextBlock.Style>
                  <Style TargetType="TextBlock"
                         BasedOn="{StaticResource ModuleSummaryLabelStyle}">
                    <Style.Triggers>
                      <DataTrigger Binding="{Binding Severity}"
                                   Value="Warning">
                        <Setter Property="Foreground"
                                Value="{StaticResource SummaryCardWarningLabelBrush}"/>
                      </DataTrigger>
                      <DataTrigger Binding="{Binding Severity}"
                                   Value="Success">
                        <Setter Property="Foreground"
                                Value="{StaticResource SummaryCardSuccessLabelBrush}"/>
                      </DataTrigger>
                    </Style.Triggers>
                  </Style>
                </TextBlock.Style>
              </TextBlock>
              <TextBlock Text="{Binding Value}"
                         Margin="0,4,0,0"
                         Style="{StaticResource ModuleSummaryValueStyle}"/>
              <TextBlock Text="{Binding Description}"
                         Margin="0,2,0,0">
                <TextBlock.Style>
                  <Style TargetType="TextBlock"
                         BasedOn="{StaticResource ModuleSummaryLabelStyle}">
                    <Style.Triggers>
                      <DataTrigger Binding="{Binding Severity}"
                                   Value="Warning">
                        <Setter Property="Foreground"
                                Value="{StaticResource SummaryCardWarningLabelBrush}"/>
                      </DataTrigger>
                      <DataTrigger Binding="{Binding Severity}"
                                   Value="Success">
                        <Setter Property="Foreground"
                                Value="{StaticResource SummaryCardSuccessLabelBrush}"/>
                      </DataTrigger>
                    </Style.Triggers>
                  </Style>
                </TextBlock.Style>
              </TextBlock>
            </StackPanel>
          </Border>
        </DataTemplate>
      </ItemsControl.ItemTemplate>
    </ItemsControl>

    <ItemsControl Grid.Row="2"
                  ItemsSource="{Binding PredictiveCards}"
                  Margin="0,0,0,16">
      <ItemsControl.ItemsPanel>
        <ItemsPanelTemplate>
          <WrapPanel Orientation="Horizontal"/>
        </ItemsPanelTemplate>
      </ItemsControl.ItemsPanel>
      <ItemsControl.ItemTemplate>
        <DataTemplate>
          <Border Padding="12"
                  Margin="0,0,12,12"
                  CornerRadius="8">
            <Border.Style>
              <Style TargetType="Border"
                     BasedOn="{StaticResource ModuleSummaryCardNeutralStyle}">
                <Style.Triggers>
                  <DataTrigger Binding="{Binding RiskLevel}"
                               Value="High">
                    <Setter Property="Background"
                            Value="{StaticResource SummaryCardWarningBackgroundBrush}"/>
                    <Setter Property="BorderBrush"
                            Value="{StaticResource SummaryCardWarningBorderBrush}"/>
                  </DataTrigger>
                  <DataTrigger Binding="{Binding RiskLevel}"
                               Value="Medium">
                    <Setter Property="Background"
                            Value="#FFF8F0E3"/>
                    <Setter Property="BorderBrush"
                            Value="#FFEEDFCC"/>
                  </DataTrigger>
                </Style.Triggers>
              </Style>
            </Border.Style>
            <StackPanel ToolTip="Shows at-risk approvals predicted before breach.">
              <StackPanel Orientation="Horizontal"
                          HorizontalAlignment="Stretch">
                <TextBlock Text="{Binding AgreementName}"
                           FontWeight="SemiBold"/>
                <TextBlock Text="{Binding Module}"
                           Margin="12,0,0,0"
                           Foreground="#FF5B7085"/>
              </StackPanel>
              <TextBlock Text="{Binding RiskDisplay}"
                         Margin="0,4,0,0"
                         Style="{StaticResource ModuleSummaryLabelStyle}"/>
              <TextBlock Text="{Binding EtaDisplay}"
                         Margin="0,2,0,0"/>
              <TextBlock Text="{Binding PotentialDisplay}"
                         Margin="0,2,0,0"/>
              <TextBlock Text="{Binding ImpactedSummary}"
                         Margin="0,4,0,0"
                         TextWrapping="Wrap"
                         Foreground="#FF5B7085"
                         FontSize="12"/>
              <TextBlock Text="{Binding DriverSummary}"
                         Margin="0,4,0,0"
                         TextWrapping="Wrap"
                         FontSize="12"/>
              <TextBlock Text="{Binding Approver}"
                         Margin="0,4,0,0"
                         Foreground="#FF2F4F94"/>
              <StackPanel Orientation="Horizontal"
                          Margin="0,6,0,0">
                <TextBlock Text="Age"
                           FontWeight="SemiBold"/>
                <TextBlock Text=":"
                           Margin="4,0,0,0"/>
                <TextBlock Text="{Binding AgeDisplay}"
                           Margin="4,0,0,0"/>
                <TextBlock Text="Next step"
                           FontWeight="SemiBold"
                           Margin="12,0,0,0"/>
                <TextBlock Text=":"
                           Margin="4,0,0,0"/>
                <TextBlock Text="{Binding ActionHint}"
                           Margin="4,0,0,0"
                           Foreground="#FF5B7085"/>
              </StackPanel>
            </StackPanel>
          </Border>
        </DataTemplate>
      </ItemsControl.ItemTemplate>
    </ItemsControl>

    <TextBlock Grid.Row="2"
               Text="No at-risk approvals predicted in the next window."
               Foreground="Gray"
               HorizontalAlignment="Center"
               VerticalAlignment="Center">
      <TextBlock.Style>
        <Style TargetType="TextBlock">
          <Setter Property="Visibility"
                  Value="Collapsed"/>
          <Style.Triggers>
            <DataTrigger Binding="{Binding PredictiveCards.Count}"
                         Value="0">
              <Setter Property="Visibility"
                      Value="Visible"/>
            </DataTrigger>
          </Style.Triggers>
        </Style>
      </TextBlock.Style>
    </TextBlock>

    <Grid Grid.Row="3">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="3*"/>
        <ColumnDefinition Width="2*"/>
      </Grid.ColumnDefinitions>

      <Border Grid.Column="0"
              Background="#FFF9FBFF"
              BorderBrush="#FFCBD8FF"
              BorderThickness="1"
              CornerRadius="8"
              Padding="16"
              Margin="0,0,16,0">
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
          </Grid.RowDefinitions>

          <TextBlock Text="Module breach heat map"
                     FontWeight="SemiBold"
                     FontSize="14"/>

          <ItemsControl x:Name="HeatMapItems"
                        Grid.Row="1"
                        Margin="0,12,0,0"
                        ItemsSource="{Binding HeatMap}">
            <ItemsControl.ItemsPanel>
              <ItemsPanelTemplate>
                <UniformGrid Columns="3"/>
              </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <Border Margin="0,0,12,12"
                        Padding="12"
                        CornerRadius="6"
                        Background="{Binding HeatBrush}">
                  <StackPanel>
                    <TextBlock Text="{Binding Module}"
                               FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding PendingDisplay}"
                               Margin="0,4,0,0"/>
                    <TextBlock Text="{Binding BreachDisplay}"
                               Margin="0,2,0,0"/>
                    <TextBlock Text="{Binding PotentialDisplay}"
                               Margin="0,4,0,0"
                               FontSize="12"/>
                  </StackPanel>
                </Border>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>

          <TextBlock Grid.Row="1"
                     Text="No pending approvals to score."
                     Foreground="Gray"
                     HorizontalAlignment="Center"
                     VerticalAlignment="Center">
            <TextBlock.Style>
              <Style TargetType="TextBlock">
                <Setter Property="Visibility"
                        Value="Collapsed"/>
                <Style.Triggers>
                  <DataTrigger Binding="{Binding ElementName=HeatMapItems, Path=HasItems}"
                               Value="False">
                    <Setter Property="Visibility"
                            Value="Visible"/>
                  </DataTrigger>
                </Style.Triggers>
              </Style>
            </TextBlock.Style>
          </TextBlock>
        </Grid>
      </Border>

      <Border Grid.Column="1"
              Background="#FFFBFAF5"
              BorderBrush="#FFEEDFCC"
              BorderThickness="1"
              CornerRadius="8"
              Padding="16">
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
          </Grid.RowDefinitions>

          <TextBlock Text="Escalation queue (â‰¥24h)"
                     FontWeight="SemiBold"
                     FontSize="14"/>

          <ListBox Grid.Row="1"
                   Margin="0,12,0,0"
                   ItemsSource="{Binding Escalations}"
                   BorderBrush="#FFEEDFCC"
                   BorderThickness="1">
            <ListBox.ItemTemplate>
              <DataTemplate>
                <Border Margin="0,0,0,12"
                        Padding="12"
                        CornerRadius="6"
                        BorderBrush="#FFEEDFCC"
                        BorderThickness="1">
                  <StackPanel>
                    <StackPanel Orientation="Horizontal"
                                HorizontalAlignment="Stretch">
                      <TextBlock Text="{Binding AgreementName}"
                                 FontWeight="SemiBold"/>
                      <TextBlock Text="{Binding Module}"
                                 Margin="12,0,0,0"
                                 Foreground="#FF5B7085"/>
                    </StackPanel>
                    <TextBlock Text="{Binding Approver}"
                               Foreground="#FF2F4F94"
                               Margin="0,4,0,0"/>
                    <TextBlock Text="{Binding ImpactedSummary}"
                               Foreground="#FF5B7085"
                               FontSize="12"
                               Margin="0,2,0,0"
                               TextWrapping="Wrap"/>
                    <StackPanel Orientation="Horizontal"
                                Margin="0,6,0,0">
                      <TextBlock Text="Age"
                                 FontWeight="SemiBold"/>
                      <TextBlock Text=":"
                                 Margin="4,0,0,0"/>
                      <TextBlock Text="{Binding AgeDisplay}"
                                 Margin="4,0,0,0"/>
                      <TextBlock Text="Requested"
                                 FontWeight="SemiBold"
                                 Margin="16,0,0,0"/>
                      <TextBlock Text=":"
                                 Margin="4,0,0,0"/>
                      <TextBlock Text="{Binding RequestedDisplay}"
                                 Margin="4,0,0,0"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal"
                                Margin="0,2,0,0">
                      <TextBlock Text="Value"
                                 FontWeight="SemiBold"/>
                      <TextBlock Text=":"
                                 Margin="4,0,0,0"/>
                      <TextBlock Text="{Binding PotentialDisplay}"
                                 Margin="4,0,0,0"/>
                    </StackPanel>
                  </StackPanel>
                </Border>
              </DataTemplate>
            </ListBox.ItemTemplate>
          </ListBox>

          <TextBlock Grid.Row="1"
                     Text="No approvals have breached the escalation threshold."
                     Foreground="Gray"
                     HorizontalAlignment="Center"
                     VerticalAlignment="Center">
            <TextBlock.Style>
              <Style TargetType="TextBlock">
                <Setter Property="Visibility"
                        Value="Collapsed"/>
                <Style.Triggers>
                  <DataTrigger Binding="{Binding Escalations.Count}"
                               Value="0">
                    <Setter Property="Visibility"
                            Value="Visible"/>
                  </DataTrigger>
                </Style.Triggers>
              </Style>
            </TextBlock.Style>
          </TextBlock>
        </Grid>
      </Border>
    </Grid>

    <DockPanel Grid.Row="4"
               Margin="0,16,0,0">
      <Button DockPanel.Dock="Right"
              Content="Refresh"
              Width="96"
              Height="32"
              Command="{Binding RefreshCommand}"/>
      <TextBlock Text="{Binding StatusMessage}"
                 VerticalAlignment="Center"
                 Foreground="Gray"/>
    </DockPanel>
  </Grid>
</UserControl>
